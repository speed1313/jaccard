<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Jaccard係数 計算機（Unicode N-gram対応）</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; max-width: 600px; margin: auto; }
    textarea { width: 100%; height: 100px; }
    button { margin-top: 1rem; }
  </style>
</head>
<body>
  <h1>Jaccard係数 計算機</h1>
  <p>2つのテキストをUnicodeベースの文字N-gramで比較し、Jaccard係数（集合の類似度）を計算します。</p>

  <label>テキスト1:</label><br>
  <textarea id="text1"></textarea><br><br>
  <label>テキスト2:</label><br>
  <textarea id="text2"></textarea><br><br>
  <label>N-gramサイズ: <input id="ngramSize" type="number" value="2" min="1" max="10" style="width: 4em;"></label><br>
  <button onclick="calculate()">計算する</button>

  <h2>結果: <span id="result">---</span></h2>

  <script>
    function tokenize(text, n = 2) {
      const norm = text.normalize("NFKC").replace(/\s+/g, ""); // 正規化 + 空白除去
      const tokens = new Set();
      for (let i = 0; i <= norm.length - n; i++) {
        tokens.add(norm.slice(i, i + n));
      }
      return tokens;
    }

    function jaccard(set1, set2) {
      const intersection = new Set([...set1].filter(x => set2.has(x)));
      const union = new Set([...set1, ...set2]);
      return (union.size === 0) ? "0.0000" : (intersection.size / union.size).toFixed(4);
    }

    function calculate() {
      const text1 = document.getElementById("text1").value;
      const text2 = document.getElementById("text2").value;
      const n = parseInt(document.getElementById("ngramSize").value) || 2;
      const set1 = tokenize(text1, n);
      const set2 = tokenize(text2, n);
      const score = jaccard(set1, set2);
      document.getElementById("result").innerText = score;
    }
  </script>
</body>
</html>
